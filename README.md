# MassBank-similarity-service
A REST interface wrapping [matchms](https://github.com/matchms/matchms) for MassBank.

This server was generated by the [OpenAPI Generator](https://openapi-generator.tech) project and uses
the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Requirements
Tested on Python 3.12

## Configuration
This microservice is configured with environment variables. The reference
spectra are initialized from a local file. The file location needs to be
configured in the environment variable `MSP`. For MassBank we configure the
service with the latest MassBank-data release in msp format.
```bash
wget https://github.com/MassBank/MassBank-data/releases/latest/download/MassBank.msp_NIST
export MSP="./MassBank.msp_NIST"
```
A more verbose logging can be activated by setting environment variable VERBOSE
to "true".
```bash
export VERBOSE=true
```

## Usage
To run the server, install the requirements, generate the server code 
and start the server like this:
```bash
pip3 install -r requirements.txt
bash generate.sh
python3 -m similarity_service_impl
```
You can find the swagger ui at http://localhost:8080/ui/ and the
OpenAPI definition at http://localhost:8080/openapi.json in your browser.

## Running with Docker
To run the server in a Docker container,  execute the following commands:

```bash
# building the image
docker build -t massbank-similarity-api .

# download reference data
wget https://github.com/MassBank/MassBank-data/releases/latest/download/MassBank.msp_NIST

# starting up a container
docker run -p 8080:8080 \
-v $(pwd)/MassBank.msp_NIST:/MassBank.msp_NIST \
-e MSP='/MassBank.msp_NIST' \
massbank-similarity-api
```
Prebuild docker images are available from
[quay.io/massbank/massbank-similarity-api](https://quay.io/repository/massbank/massbank-similarity-api).  
The fastest way to get things running is:
```bash
# download reference data
wget https://github.com/MassBank/MassBank-data/releases/latest/download/MassBank.msp_NIST

# starting up a container
docker run -p 8080:8080 \
-v $(pwd)/MassBank.msp_NIST:/MassBank.msp_NIST \
-e MSP='/MassBank.msp_NIST' \
quay.io/massbank/massbank-similarity-api:latest
```
